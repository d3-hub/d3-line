<!doctype html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <title>Document</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f1f2f3;
        }

        #chartArea {
            margin: 4em auto 2rem;
        }

        .line {
            fill: none;
            stroke: #f33155;
            stroke-width: 2px;
        }

        body { font: 12px Arial;}

        .legend {
            font-size: 16px;
            font-weight: bold;
            text-anchor: left;
        }
    </style>
</head>
<body>
<!-- 参考：https://codepen.io/bloom-dan/pen/mOmgam -->
<div id='chartArea'></div>

<h2>Simple Curved Line Chart</h2>
<h4>Built with D3 v4</h4>
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
<script>
  const data = [
    {'date': '1-May-16', 'close': 558.13},
    {'date': '30-Apr-16', 'close': 553.98},
    {'date': '27-Apr-16', 'close': 567},
    {'date': '26-Apr-16', 'close': 589.7},
    {'date': '25-Apr-16', 'close': 599},
    {'date': '24-Apr-16', 'close': 630.28},
    {'date': '23-Apr-16', 'close': 666.7},
    {'date': '20-Apr-16', 'close': 634.98},
    {'date': '19-Apr-16', 'close': 645.44},
    {'date': '18-Apr-16', 'close': 643.34},
    {'date': '17-Apr-16', 'close': 543.7},
    {'date': '16-Apr-16', 'close': 580.13},
    {'date': '13-Apr-16', 'close': 605.23},
    {'date': '12-Apr-16', 'close': 622.77},
    {'date': '11-Apr-16', 'close': 626.2},
    {'date': '10-Apr-16', 'close': 628.44},
    {'date': '9-Apr-16', 'close': 636.23},
    {'date': '5-Apr-16', 'close': 633.68},
    {'date': '4-Apr-16', 'close': 624.31},
    {'date': '3-Apr-16', 'close': 629.32},
    {'date': '2-Apr-16', 'close': 618.63},
    {'date': '30-Mar-16', 'close': 599.55},
    {'date': '29-Mar-16', 'close': 609.86},
    {'date': '28-Mar-16', 'close': 617.62},
    {'date': '27-Mar-16', 'close': 614.48},
    {'date': '26-Mar-16', 'close': 606.98}
  ]


  const margin = {top: 20, right: 20, bottom: 30, left: 50}
  const width = 420 - margin.left - margin.right
  const height = 300 - margin.top - margin.bottom

  const parseTime = d3.timeParse('%d-%b-%y')


  const x = d3.scaleTime().range([0, width])
  const y = d3.scaleLinear().range([height, 0])


  const valueline = d3.line()
    .curve(d3.curveCatmullRomOpen)
    .x(d => x(d.date))
    .y(d => y(d.close))

  
  const svg = d3.select('#chartArea').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
    .append('g')
    .attr('transform', `translate(${margin.left}, ${margin.top})`)

  const drawGraph = data => {

    data.forEach(d => {
      d.date = parseTime(d.date)
      d.close = +d.close
    })

    x.domain(d3.extent(data, d => d.date))

    y.domain([d3.min(data, d => d.close - margin.top), d3.max(data, d => d.close + margin.top)])

    svg.append('path')
      .data([data])
      .attr('class', 'line')
      .attr('d', valueline)

    svg.append('g')
      .attr('transform', `translate(0, ${height})`)
      .call(d3.axisBottom(x).ticks(5))

    svg.append('g')
      .call(d3.axisLeft(y).ticks(8))

  }

  //drawGraph
  drawGraph(data)


</script>
</body>
</html>